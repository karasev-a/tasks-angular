<h2>Users</h2>
<mat-table [dataSource]="userDataSource">
    <ng-container matColumnDef="firstName">
        <mat-header-cell *matHeaderCellDef> First Name </mat-header-cell>
        <mat-cell *matCellDef="let user"> {{user?.firstName}} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="lastName">
        <mat-header-cell *matHeaderCellDef> Last Name </mat-header-cell>
        <mat-cell *matCellDef="let user"> {{user?.lastName}} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="createdAt">
        <mat-header-cell *matHeaderCellDef> Date of Registration </mat-header-cell>
        <mat-cell *matCellDef="let user"> {{user?.createdAt | date}} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="allTasks">
        <mat-header-cell *matHeaderCellDef> All Tasks </mat-header-cell>
        <mat-cell *matCellDef="let user">
            <div *ngFor="let status of user.Tasks; let i = index">
                <p>
                    {{status.countTasks}}+
                </p>
            </div>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="onReview">
        <mat-header-cell *matHeaderCellDef> On Review </mat-header-cell>
        <mat-cell *matCellDef="let user">
            <div *ngFor="let status of user.Tasks">
                <p *ngIf="status.status === 1">
                    {{status.countTasks}}
                </p>
            </div>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="open">
        <mat-header-cell *matHeaderCellDef> Open </mat-header-cell>
        <mat-cell *matCellDef="let user">
            <div *ngFor="let status of user.Tasks">
                <p *ngIf="status.status === 2">
                    {{status.countTasks}}
                </p>
            </div>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="pending">
        <mat-header-cell *matHeaderCellDef> Pending </mat-header-cell>
        <mat-cell *matCellDef="let user">
            <div *ngFor="let status of user.Tasks">
                <p *ngIf="status.status === 3">
                    {{status.countTasks}}
                </p>
            </div>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="done">
        <mat-header-cell *matHeaderCellDef> Done </mat-header-cell>
        <mat-cell *matCellDef="let user">
            <div *ngFor="let status of user.Tasks">
                <p *ngIf="status.status === 4">
                    {{status.countTasks}}
                </p>
            </div>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="decline">
        <mat-header-cell *matHeaderCellDef> Decline </mat-header-cell>
        <mat-cell *matCellDef="let user">
            <div *ngFor="let status of user.Tasks">
                <p *ngIf="status.status === 5">
                    {{status.countTasks}}
                </p>
            </div>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="role">
        <mat-header-cell *matHeaderCellDef> Role </mat-header-cell>
        <mat-cell *matCellDef="let user">
            <select [value]="user.roleId" (change)="onSelectRole($event.target.value, user, user.id)">
                <option *ngFor="let key of keysOfRoles" [value]="key">
                    {{roles[key]}}
                </option>
            </select>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
        <mat-cell *matCellDef="let user">
            <button mat-button (click)="saveUser(user)" [disabled]="user.id !== userId">
                Save
            </button>
            <button mat-button (click)="cancelEdit(user)" [disabled]="user.id !== userId">
                Cancel
            </button>
        </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
</mat-table>